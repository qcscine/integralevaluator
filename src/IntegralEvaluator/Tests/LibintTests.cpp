/**
 * @file
 * @copyright This code is licensed under the 3-clause BSD license.\n
 *            Copyright ETH Zurich, Laboratory of Physical Chemistry, Reiher Group.\n
 *            See LICENSE.txt for details.
 */

#include <LibintIntegrals/Libint.h>
#include <LibintIntegrals/LibintIntegrals.h>
#include <LibintIntegrals/TwoBodyIntegrals/CauchySchwarzDensityPrescreener.h>
#include <LibintIntegrals/TwoBodyIntegrals/Evaluator.h>
#include <LibintIntegrals/TwoBodyIntegrals/HartreeFock/CoulombExchangeDigester.h>
#include <LibintIntegrals/TwoBodyIntegrals/HartreeFock/TwoTypeCoulombDigester.h>
#include <Utils/Constants.h>
#include <Utils/IO/ChemicalFileFormats/XyzStreamHandler.h>
#include <gmock/gmock.h>

using namespace testing;

class LibintTest : public Test {
 private:
  std::vector<libint2::Atom> atoms;
  libint2::BasisSet obs;
  Eigen::MatrixXd S, T, V, F, D;
  Eigen::MatrixXd S_test, T_test, V_test, F_test;
  int dim;

 public:
  void testS();
  void testT();
  void testV();
  void testF();

  auto compute1e(libint2::Operator op) -> Eigen::MatrixXd {
    libint2::initialize(true);

    Eigen::MatrixXd result(obs.nbf(), obs.nbf());

    libint2::Engine engine(op,              // will compute overlap ints
                           obs.max_nprim(), // max # of primitives in shells this engine will accept
                           obs.max_l()      // max angular momentum of shells this engine will accept
    );

    if (op == libint2::Operator::nuclear) {
      engine.set_params(libint2::make_point_charges(atoms));
    }

    auto shell2bf = obs.shell2bf();         // maps shell index to basis function index
                                            // shell2bf[0] = index of the first basis function in shell 0
                                            // shell2bf[1] = index of the first basis function in shell 1
                                            // ...
    const auto& buf_vec = engine.results(); // will point to computed shell sets
                                            // const auto& is very important!

    for (auto s1 = 0UL; s1 != obs.size(); ++s1) {
      for (auto s2 = 0UL; s2 != obs.size(); ++s2) {
        engine.compute(obs[s1], obs[s2]);
        auto ints_shellset = buf_vec[0]; // location of the computed integrals
        if (ints_shellset == nullptr)
          continue; // nullptr returned if the entire shell-set was screened out

        auto bf1 = shell2bf[s1];  // first basis function in first shell
        auto n1 = obs[s1].size(); // number of basis functions in first shell
        auto bf2 = shell2bf[s2];  // first basis function in second shell
        auto n2 = obs[s2].size(); // number of basis functions in second shell

        // integrals are packed into ints_shellset in row-major (C) form
        // this iterates over integrals in this order
        for (auto f1 = 0UL; f1 != n1; ++f1) {
          for (auto f2 = 0UL; f2 != n2; ++f2) {
            result(bf1 + f1, bf2 + f2) = ints_shellset[f1 * n2 + f2];
          }
        }
      }
    }

    libint2::finalize();

    return result;
  }

  Eigen::MatrixXd compute_2body_fock() {
    libint2::initialize(true);

    using libint2::Engine;
    using libint2::Operator;
    using libint2::Shell;

    auto time_elapsed = std::chrono::duration<double>::zero();

    Eigen::MatrixXd G(obs.nbf(), obs.nbf());
    G.setZero();

    // construct the 2-electron repulsion integrals engine
    libint2::Engine engine(Operator::coulomb, // will compute overlap ints
                           obs.max_nprim(),   // max # of primitives in shells this engine will accept
                           obs.max_l()        // max angular momentum of shells this engine will accept
    );

    auto shell2bf = obs.shell2bf(); // maps shell index to basis function index

    const auto& buf = engine.results();

    for (auto s1 = 0UL; s1 != obs.size(); ++s1) {
      auto bf1_first = shell2bf[s1]; // first basis function in this shell
      auto n1 = obs[s1].size();      // number of basis functions in this shell

      for (auto s2 = 0UL; s2 <= s1; ++s2) {
        auto bf2_first = shell2bf[s2];
        auto n2 = obs[s2].size();

        for (auto s3 = 0UL; s3 <= s1; ++s3) {
          auto bf3_first = shell2bf[s3];
          auto n3 = obs[s3].size();

          const auto s4_max = (s1 == s3) ? s2 : s3;
          for (auto s4 = 0UL; s4 <= s4_max; ++s4) {
            auto bf4_first = shell2bf[s4];
            auto n4 = obs[s4].size();

            // compute the permutational degeneracy (i.e. # of equivalents) of the given shell set
            auto s12_deg = (s1 == s2) ? 1.0 : 2.0;
            auto s34_deg = (s3 == s4) ? 1.0 : 2.0;
            auto s12_34_deg = (s1 == s3) ? (s2 == s4 ? 1.0 : 2.0) : 2.0;
            auto s1234_deg = s12_deg * s34_deg * s12_34_deg;

            const auto tstart = std::chrono::high_resolution_clock::now();

            engine.compute(obs[s1], obs[s2], obs[s3], obs[s4]);
            const auto* buf_1234 = buf[0];
            if (buf_1234 == nullptr)
              continue; // if all integrals screened out, skip to next quartet

            const auto tstop = std::chrono::high_resolution_clock::now();
            time_elapsed += tstop - tstart;

            // 1) each shell set of integrals contributes up to 6 shell sets of the Fock matrix:
            //    F(a,b) += (ab|cd) * D(c,d)
            //    F(c,d) += (ab|cd) * D(a,b)
            //    F(b,d) -= 1/4 * (ab|cd) * D(a,c)
            //    F(b,c) -= 1/4 * (ab|cd) * D(a,d)
            //    F(a,c) -= 1/4 * (ab|cd) * D(b,d)
            //    F(a,d) -= 1/4 * (ab|cd) * D(b,c)
            // 2) each permutationally-unique integral (shell set) must be scaled by its degeneracy,
            //    i.e. the number of the integrals/sets equivalent to it
            // 3) the end result must be symmetrized
            for (auto f1 = 0UL, f1234 = 0UL; f1 != n1; ++f1) {
              const auto bf1 = f1 + bf1_first;
              for (auto f2 = 0UL; f2 != n2; ++f2) {
                const auto bf2 = f2 + bf2_first;
                for (auto f3 = 0UL; f3 != n3; ++f3) {
                  const auto bf3 = f3 + bf3_first;
                  for (auto f4 = 0UL; f4 != n4; ++f4, ++f1234) {
                    const auto bf4 = f4 + bf4_first;

                    const auto value = buf_1234[f1234];

                    const auto value_scal_by_deg = value * s1234_deg;

                    G(bf1, bf2) += 0.5 * D(bf3, bf4) * value_scal_by_deg;
                    G(bf3, bf4) += 0.5 * D(bf1, bf2) * value_scal_by_deg;
                    G(bf1, bf3) -= 0.125 * D(bf2, bf4) * value_scal_by_deg;
                    G(bf2, bf4) -= 0.125 * D(bf1, bf3) * value_scal_by_deg;
                    G(bf1, bf4) -= 0.125 * D(bf2, bf3) * value_scal_by_deg;
                    G(bf2, bf3) -= 0.125 * D(bf1, bf4) * value_scal_by_deg;
                  }
                }
              }
            }
          }
        }
      }
    }

    libint2::finalize();
    // symmetrize the result and return
    Eigen::MatrixXd Gt = G.transpose();
    return 0.5 * (G + Gt);
  }

 private:
  void SetUp() final {
    std::stringstream xyzInput("3\n\n"
                               "O          0.00000       -0.07579        0.00000\n"
                               "H          0.86681        0.60144        0.00000\n"
                               "H         -0.86681        0.60144        0.00000");

    auto scineAtoms = Scine::Utils::XyzStreamHandler::read(xyzInput);

    atoms = Scine::Integrals::BasisSetHandler::scineToLibint(scineAtoms);

    obs = libint2::BasisSet("def2-svp", atoms);

    dim = obs.nbf();

    obs.set_pure(true); // use solid harmonics

    S.resize(obs.nbf(), obs.nbf());
    V.resize(obs.nbf(), obs.nbf());
    T.resize(obs.nbf(), obs.nbf());
    F.resize(obs.nbf(), obs.nbf());
    D.resize(obs.nbf(), obs.nbf());

    S << 1.0000000000, -0.3440165538, -0.1578700420, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0304450779,
        -0.0551422538, 0.0299852486, 0.0000000000, 0.0383791523, -0.0304450779, -0.0551422538, 0.0299852486,
        0.0000000000, -0.0383791523, -0.3440165538, 1.0000000000, 0.7889407941, -0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.2378394241, 0.3504547031, -0.2023529803, 0.0000000000, -0.2589985483, 0.2378394241, 0.3504547031,
        -0.2023529803, 0.0000000000, 0.2589985483, -0.1578700420, 0.7889407941, 1.0000000000, -0.0000000000,
        0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000,
        0.0000000000, 0.0000000000, 0.4281962808, 0.6333580662, -0.1902346615, 0.0000000000, -0.2434878947,
        0.4281962808, 0.6333580662, -0.1902346615, 0.0000000000, 0.2434878947, 0.0000000000, -0.0000000000,
        -0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.5021408928, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1344279808, 0.0667498451, -0.0609705774, 0.0000000000,
        -0.2209844868, 0.1344279808, 0.0667498451, -0.0609705774, 0.0000000000, 0.2209844868, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.5021408928, 0.0000000000, 0.0000000000,
        -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1116823961,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1116823961, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.5021408928, -0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1720590022, 0.0854354256, -0.2209844868, 0.0000000000,
        -0.1711632589, -0.1720590022, -0.0854354256, 0.2209844868, 0.0000000000, -0.1711632589, -0.0000000000,
        0.0000000000, -0.0000000000, 0.5021408928, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.3639829788, 0.2529201814, 0.0960643502,
        0.0000000000, -0.2529805111, 0.3639829788, 0.2529201814, 0.0960643502, 0.0000000000, 0.2529805111, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.5021408928, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.2937154981, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.2937154981, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.5021408928, 0.0000000000, 0.0000000000, 1.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.4658743498, 0.3237212504, -0.2529805111,
        0.0000000000, -0.0300829704, -0.4658743498, -0.3237212504, 0.2529805111, 0.0000000000, -0.0300829704,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1591571644, 0.0233688263,
        -0.0981122740, 0.0000000000, -0.2110591986, -0.1591571644, -0.0233688263, 0.0981122740, 0.0000000000,
        -0.2110591986, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.1339354621, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.1339354621, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, -0.0000000000,
        -0.0947023720, -0.0139050183, 0.0830556868, 0.0000000000, 0.1063058339, -0.0947023720, -0.0139050183,
        0.0830556868, 0.0000000000, -0.1063058339, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1714286105, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.1714286105, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000,
        1.0000000000, 0.0396814161, 0.0058263674, -0.2011379913, 0.0000000000, 0.0854137790, 0.0396814161, 0.0058263674,
        -0.2011379913, 0.0000000000, -0.0854137790, -0.0304450779, 0.2378394241, 0.4281962808, 0.1344279808,
        0.0000000000, 0.1720590022, 0.3639829788, 0.0000000000, 0.4658743498, 0.1591571644, 0.0000000000, -0.0947023720,
        0.0000000000, 0.0396814161, 1.0000000000, 0.6847998247, -0.0000000000, 0.0000000000, -0.0000000000,
        0.0664093652, 0.2399412363, -0.0000000000, 0.0000000000, 0.0763321141, -0.0551422538, 0.3504547031,
        0.6333580662, 0.0667498451, 0.0000000000, 0.0854354256, 0.2529201814, 0.0000000000, 0.3237212504, 0.0233688263,
        0.0000000000, -0.0139050183, 0.0000000000, 0.0058263674, 0.6847998247, 1.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.2399412363, 0.5197438619, 0.0000000000, 0.0000000000, 0.1388685640, 0.0299852486, -0.2023529803,
        -0.1902346615, -0.0609705774, 0.0000000000, -0.2209844868, 0.0960643502, 0.0000000000, -0.2529805111,
        -0.0981122740, 0.0000000000, 0.0830556868, 0.0000000000, -0.2011379913, -0.0000000000, 0.0000000000,
        1.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0136632435, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1116823961, 0.0000000000, 0.0000000000, 0.2937154981,
        0.0000000000, 0.0000000000, 0.1339354621, 0.0000000000, 0.1714286105, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0136632435, 0.0000000000,
        0.0383791523, -0.2589985483, -0.2434878947, -0.2209844868, 0.0000000000, -0.1711632589, -0.2529805111,
        0.0000000000, -0.0300829704, -0.2110591986, 0.0000000000, 0.1063058339, 0.0000000000, 0.0854137790,
        -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000, -0.0763321141, -0.1388685640,
        0.0000000000, 0.0000000000, -0.1036506223, -0.0304450779, 0.2378394241, 0.4281962808, 0.1344279808, 0.0000000000,
        -0.1720590022, 0.3639829788, 0.0000000000, -0.4658743498, -0.1591571644, 0.0000000000, -0.0947023720,
        0.0000000000, 0.0396814161, 0.0664093652, 0.2399412363, -0.0000000000, 0.0000000000, -0.0763321141,
        1.0000000000, 0.6847998247, -0.0000000000, 0.0000000000, 0.0000000000, -0.0551422538, 0.3504547031, 0.6333580662,
        0.0667498451, 0.0000000000, -0.0854354256, 0.2529201814, 0.0000000000, -0.3237212504, -0.0233688263,
        0.0000000000, -0.0139050183, 0.0000000000, 0.0058263674, 0.2399412363, 0.5197438619, 0.0000000000, 0.0000000000,
        -0.1388685640, 0.6847998247, 1.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0299852486, -0.2023529803,
        -0.1902346615, -0.0609705774, 0.0000000000, 0.2209844868, 0.0960643502, 0.0000000000, 0.2529805111,
        0.0981122740, 0.0000000000, 0.0830556868, 0.0000000000, -0.2011379913, -0.0000000000, 0.0000000000, 0.0136632435,
        0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.1116823961, 0.0000000000, 0.0000000000, 0.2937154981, 0.0000000000,
        0.0000000000, 0.1339354621, 0.0000000000, -0.1714286105, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0136632435, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000, 0.0000000000, -0.0383791523,
        0.2589985483, 0.2434878947, 0.2209844868, 0.0000000000, -0.1711632589, 0.2529805111, 0.0000000000, -0.0300829704,
        -0.2110591986, 0.0000000000, -0.1063058339, 0.0000000000, -0.0854137790, 0.0763321141, 0.1388685640,
        0.0000000000, 0.0000000000, -0.1036506223, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 1.0000000000;
    T << 29.3566543814, -0.7681118716, -0.1175493620, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0107093788,
        -0.0130034901, -0.0296573215, 0.0000000000, -0.0379594271, 0.0107093788, -0.0130034901, -0.0296573215,
        0.0000000000, 0.0379594271, -0.7681118716, 1.2146396350, 0.4594187166, -0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0126256526, 0.0774100395, -0.1239598372, 0.0000000000, -0.1586604647, 0.0126256526, 0.0774100395,
        -0.1239598372, 0.0000000000, 0.1586604647, -0.1175493620, 0.4594187166, 0.3829615835, -0.0000000000,
        0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.1099041393, 0.1195312730, -0.1225100090, 0.0000000000, -0.1568047796,
        0.1099041393, 0.1195312730, -0.1225100090, 0.0000000000, 0.1568047796, 0.0000000000, -0.0000000000,
        -0.0000000000, 4.3323265924, 0.0000000000, 0.0000000000, 0.5611807178, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0707183890, 0.0297509256, -0.1841040867, 0.0000000000,
        -0.2934199020, 0.0707183890, 0.0297509256, -0.1841040867, 0.0000000000, 0.2934199020, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 4.3323265924, 0.0000000000, 0.0000000000, 0.5611807178, 0.0000000000, 0.0000000000,
        -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0451419536,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0451419536, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 4.3323265924, 0.0000000000, 0.0000000000, 0.5611807178, -0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0905149015, 0.0380792343, -0.2934199020, 0.0000000000,
        -0.3304162840, -0.0905149015, -0.0380792343, 0.2934199020, 0.0000000000, -0.3304162840, 0.0000000000,
        0.0000000000, -0.0000000000, 0.5611807178, 0.0000000000, 0.0000000000, 0.6910386103, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.2243969852, 0.0913575024, -0.0175705625,
        0.0000000000, -0.2715289423, 0.2243969852, 0.0913575024, -0.0175705625, 0.0000000000, 0.2715289423, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.5611807178, 0.0000000000, 0.0000000000, 0.6910386103, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.1945722896, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1945722896, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.5611807178, 0.0000000000, 0.0000000000, 0.6910386103,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.2872134293, 0.1169316136, -0.2715289423,
        0.0000000000, -0.1529669548, -0.2872134293, -0.1169316136, 0.2715289423, 0.0000000000, -0.1529669548,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 4.2000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.1797360056, 0.0156336490,
        -0.3930640072, 0.0000000000, -0.6201113724, -0.1797360056, -0.0156336490, 0.3930640072, 0.0000000000,
        -0.6201113724, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 4.2000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.1833427064, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.1833427064, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 4.2000000000, 0.0000000000, -0.0000000000,
        -0.1069472814, -0.0093024002, 0.2676619974, 0.0000000000, 0.3425898084, -0.1069472814, -0.0093024002,
        0.2676619974, 0.0000000000, -0.3425898084, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 4.2000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.2346666440, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.2346666440, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000,
        0.0000000000, 4.2000000000, 0.0448121782, 0.0038978159, -0.3398499001, 0.0000000000, 0.0343476969, 0.0448121782,
        0.0038978159, -0.3398499001, 0.0000000000, -0.0343476969, 0.0107093788, 0.0126256526, 0.1099041393,
        0.0707183890, 0.0000000000, 0.0905149015, 0.2243969852, 0.0000000000, 0.2872134293, 0.1797360056, 0.0000000000,
        -0.1069472814, 0.0000000000, 0.0448121782, 0.9692259316, 0.2011415949, -0.0000000000, 0.0000000000,
        -0.0000000000, -0.0335812924, 0.0210470588, 0.0000000000, 0.0000000000, -0.0320144364, -0.0130034901,
        0.0774100395, 0.1195312730, 0.0297509256, 0.0000000000, 0.0380792343, 0.0913575024, 0.0000000000, 0.1169316136,
        0.0156336490, 0.0000000000, -0.0093024002, 0.0000000000, 0.0038978159, 0.2011415949, 0.1829244300, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0210470588, 0.0535950837, 0.0000000000, 0.0000000000, 0.0400961580, -0.0296573215,
        -0.1239598372, -0.1225100090, -0.1841040867, 0.0000000000, -0.2934199020, -0.0175705625, 0.0000000000,
        -0.2715289423, -0.3930640072, 0.0000000000, 0.2676619974, 0.0000000000, -0.3398499001, -0.0000000000,
        0.0000000000, 2.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0195990594, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0451419536, 0.0000000000, 0.0000000000,
        0.1945722896, 0.0000000000, 0.0000000000, 0.1833427064, 0.0000000000, 0.2346666440, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 2.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0195990594,
        0.0000000000, -0.0379594271, -0.1586604647, -0.1568047796, -0.2934199020, 0.0000000000, -0.3304162840,
        -0.2715289423, 0.0000000000, -0.1529669548, -0.6201113724, 0.0000000000, 0.3425898084, 0.0000000000,
        0.0343476969, -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 2.0000000000, 0.0320144364, -0.0400961580,
        0.0000000000, 0.0000000000, 0.0548291752, 0.0107093788, 0.0126256526, 0.1099041393, 0.0707183890, 0.0000000000,
        -0.0905149015, 0.2243969852, 0.0000000000, -0.2872134293, -0.1797360056, 0.0000000000, -0.1069472814,
        0.0000000000, 0.0448121782, -0.0335812924, 0.0210470588, 0.0000000000, 0.0000000000, 0.0320144364, 0.9692259316,
        0.2011415949, -0.0000000000, 0.0000000000, 0.0000000000, -0.0130034901, 0.0774100395, 0.1195312730, 0.0297509256,
        0.0000000000, -0.0380792343, 0.0913575024, 0.0000000000, -0.1169316136, -0.0156336490, 0.0000000000,
        -0.0093024002, 0.0000000000, 0.0038978159, 0.0210470588, 0.0535950837, 0.0000000000, 0.0000000000, -0.0400961580,
        0.2011415949, 0.1829244300, 0.0000000000, 0.0000000000, 0.0000000000, -0.0296573215, -0.1239598372,
        -0.1225100090, -0.1841040867, 0.0000000000, 0.2934199020, -0.0175705625, 0.0000000000, 0.2715289423,
        0.3930640072, 0.0000000000, 0.2676619974, 0.0000000000, -0.3398499001, 0.0000000000, 0.0000000000, -0.0195990594,
        0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 2.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0451419536, 0.0000000000, 0.0000000000, 0.1945722896, 0.0000000000,
        0.0000000000, 0.1833427064, 0.0000000000, -0.2346666440, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -0.0195990594, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 2.0000000000, 0.0000000000, 0.0379594271,
        0.1586604647, 0.1568047796, 0.2934199020, 0.0000000000, -0.3304162840, 0.2715289423, 0.0000000000, -0.1529669548,
        -0.6201113724, 0.0000000000, -0.3425898084, 0.0000000000, -0.0343476969, -0.0320144364, 0.0400961580,
        0.0000000000, 0.0000000000, 0.0548291752, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 2.0000000000;
    V << -62.2461003816, 11.8363303772, 5.2283649381, 0.0202815262, 0.0000000000, 0.0000000000, 0.0027190909,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0010856108, 0.0000000000, 0.0004548838, 0.9810736634,
        1.8030936154, -0.9487209370, 0.0000000000, -1.2147533332, 0.9810736634, 1.8030936154, -0.9487209370,
        0.0000000000, 1.2147533332, 11.8363303772, -12.4497977553, -8.1070813195, -0.1422376052, 0.0000000000,
        0.0000000000, -0.1093963418, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0554478510, 0.0000000000,
        -0.0232333066, -2.1884996111, -3.3378732653, 1.9895925117, 0.0000000000, 2.5661752366, -2.1884996111,
        -3.3378732653, 1.9895925117, 0.0000000000, -2.5661752366, 5.2283649381, -8.1070813195, -7.3782989145,
        -0.1318086876, 0.0000000000, 0.0000000000, -0.2240306546, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0704792215, 0.0000000000, -0.0295316290, -2.7921210543, -3.9322473249, 1.6339624175,
        0.0000000000, 2.1305956498, -2.7921210543, -3.9322473249, 1.6339624175, 0.0000000000, -2.1305956498,
        0.0202815262, -0.1422376052, -0.1318086876, -12.7103321503, 0.0000000000, 0.0000000000, -4.3116366794,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0814670731, 0.0000000000, 0.0894379843, -1.1352409099,
        -0.5953483948, 0.6531484270, 0.0000000000, 1.9808906406, -1.1352409099, -0.5953483948, 0.6531484270,
        0.0000000000, -1.9808906406, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -12.6674266218,
        0.0000000000, 0.0000000000, -4.2694464630, 0.0000000000, 0.0000000000, -0.0995023763, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.8823571440, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.8823571440, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -12.7377158388, 0.0000000000, 0.0000000000, -4.3385638326, -0.1511695017, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, -1.4239325618, -0.6910536306, 1.9481932492, 0.0000000000, 1.6205245362, 1.4239325618,
        0.6910536306, -1.9481932492, 0.0000000000, 1.6205245362, 0.0027190909, -0.1093963418, -0.2240306546,
        -4.3116366794, 0.0000000000, 0.0000000000, -5.3730061657, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0858154438, 0.0000000000, 0.0721431791, -2.0466888346, -1.3055016583, -0.2154710684, 0.0000000000,
        1.7485838247, -2.0466888346, -1.3055016583, -0.2154710684, 0.0000000000, -1.7485838247, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, -4.2694464630, 0.0000000000, 0.0000000000, -5.2455950171, 0.0000000000,
        0.0000000000, -0.0870435798, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -1.5497748456, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -1.5497748456, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -4.3385638326, 0.0000000000, 0.0000000000, -5.4543240593,
        -0.1635371094, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -2.5734493785, -1.5072056627,
        1.6967497796, 0.0000000000, 0.6518069759, 2.5734493785, 1.5072056627, -1.6967497796, 0.0000000000, 0.6518069759,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.1511695017, 0.0000000000, 0.0000000000,
        -0.1635371094, -8.4946769339, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -1.1662192537,
        -0.1864782650, 0.8306234938, 0.0000000000, 1.6500482433, 1.1662192537, 0.1864782650, -0.8306234938,
        0.0000000000, 1.6500482433, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0995023763, 0.0000000000,
        0.0000000000, -0.0870435798, 0.0000000000, 0.0000000000, -8.3745749661, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.9269601834, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.9269601834, 0.0000000000, -0.0010856108, 0.0554478510, 0.0704792215, 0.0814670731, 0.0000000000,
        0.0000000000, 0.0858154438, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -8.3890459387, 0.0000000000,
        0.0228402052, 0.7000733176, 0.1394801787, -0.6580966936, 0.0000000000, -0.8598635868, 0.7000733176, 0.1394801787,
        -0.6580966936, 0.0000000000, 0.8598635868, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -8.4001289622,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -1.1732409104, 0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, 1.1732409104, 0.0000000000, 0.0004548838, -0.0232333066, -0.0295316290, 0.0894379843, 0.0000000000,
        0.0000000000, 0.0721431791, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0228402052, 0.0000000000,
        -8.4435560582, -0.2738066374, -0.0440412694, 1.4091387259, 0.0000000000, -0.5618715458, -0.2738066374,
        -0.0440412694, 1.4091387259, 0.0000000000, 0.5618715458, 0.9810736634, -2.1884996111, -2.7921210543,
        -1.1352409099, 0.0000000000, -1.4239325618, -2.0466888346, 0.0000000000, -2.5734493785, -1.1662192537,
        0.0000000000, 0.7000733176, 0.0000000000, -0.2738066374, -5.5172892176, -3.4311437518, 0.6928517580,
        0.0000000000, 0.9441105962, -0.4559218161, -1.3883060910, 0.0830270286, 0.0000000000, -0.5544977443,
        1.8030936154, -3.3378732653, -3.9322473249, -0.5953483948, 0.0000000000, -0.6910536306, -1.3055016583,
        0.0000000000, -1.5072056627, -0.1864782650, 0.0000000000, 0.1394801787, 0.0000000000, -0.0440412694,
        -3.4311437518, -4.1402962286, 0.5879763656, 0.0000000000, 0.8029778443, -1.3883060910, -2.5165484465,
        0.2859834906, 0.0000000000, -1.0578103829, -0.9487209370, 1.9895925117, 1.6339624175, 0.6531484270,
        0.0000000000, 1.9481932492, -0.2154710684, 0.0000000000, 1.6967497796, 0.8306234938, 0.0000000000, -0.6580966936,
        0.0000000000, 1.4091387259, 0.6928517580, 0.5879763656, -5.1294226727, 0.0000000000, -0.3983155742, 0.0830270286,
        0.2859834906, -0.1144671238, 0.0000000000, 0.0923777672, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -0.8823571440, 0.0000000000, 0.0000000000, -1.5497748456, 0.0000000000, 0.0000000000, -0.9269601834,
        0.0000000000, -1.1732409104, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -4.8182226908,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0845067369, 0.0000000000, -1.2147533332, 2.5661752366,
        2.1305956498, 1.9808906406, 0.0000000000, 1.6205245362, 1.7485838247, 0.0000000000, 0.6518069759, 1.6500482433,
        0.0000000000, -0.8598635868, 0.0000000000, -0.5618715458, 0.9441105962, 0.8029778443, -0.3983155742,
        0.0000000000, -5.3547036992, 0.5544977443, 1.0578103829, -0.0923777672, 0.0000000000, 0.7703163962,
        0.9810736634, -2.1884996111, -2.7921210543, -1.1352409099, 0.0000000000, 1.4239325618, -2.0466888346,
        0.0000000000, 2.5734493785, 1.1662192537, 0.0000000000, 0.7000733176, 0.0000000000, -0.2738066374, -0.4559218161,
        -1.3883060910, 0.0830270286, 0.0000000000, 0.5544977443, -5.5172892176, -3.4311437518, 0.6928517580,
        0.0000000000, -0.9441105962, 1.8030936154, -3.3378732653, -3.9322473249, -0.5953483948, 0.0000000000,
        0.6910536306, -1.3055016583, 0.0000000000, 1.5072056627, 0.1864782650, 0.0000000000, 0.1394801787, 0.0000000000,
        -0.0440412694, -1.3883060910, -2.5165484465, 0.2859834906, 0.0000000000, 1.0578103829, -3.4311437518,
        -4.1402962286, 0.5879763656, 0.0000000000, -0.8029778443, -0.9487209370, 1.9895925117, 1.6339624175,
        0.6531484270, 0.0000000000, -1.9481932492, -0.2154710684, 0.0000000000, -1.6967497796, -0.8306234938,
        0.0000000000, -0.6580966936, 0.0000000000, 1.4091387259, 0.0830270286, 0.2859834906, -0.1144671238, 0.0000000000,
        -0.0923777672, 0.6928517580, 0.5879763656, -5.1294226727, 0.0000000000, 0.3983155742, 0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, -0.8823571440, 0.0000000000, 0.0000000000, -1.5497748456, 0.0000000000, 0.0000000000,
        -0.9269601834, 0.0000000000, 1.1732409104, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0845067369,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -4.8182226908, 0.0000000000, 1.2147533332, -2.5661752366,
        -2.1305956498, -1.9808906406, 0.0000000000, 1.6205245362, -1.7485838247, 0.0000000000, 0.6518069759,
        1.6500482433, 0.0000000000, 0.8598635868, 0.0000000000, 0.5618715458, -0.5544977443, -1.0578103829, 0.0923777672,
        0.0000000000, 0.7703163962, -0.9441105962, -0.8029778443, 0.3983155742, 0.0000000000, -5.3547036992;
    F << -16.5154344730, 6.2863146759, 2.9709005944, 0.0092527796, 0.0000000000, 0.0000000000, 0.0025959735,
        0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, -0.0012368604, 0.0000000000, 0.0005480903,
        0.5885029073, 1.0503876896, -0.5834574699, 0.0000000000, -0.7472930712, 0.5885029073, 1.0503876896,
        -0.5834574699, 0.0000000000, 0.7472930712, 6.2863146759, -1.8716085978, -1.1480661321, -0.1104418179,
        -0.0000000000, -0.0000000000, -0.0964068601, -0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000,
        0.0610080248, -0.0000000000, -0.0261147588, -0.3928260456, -0.5326786265, 0.2433241368, -0.0000000000,
        0.3262986782, -0.3928260456, -0.5326786265, 0.2433241368, -0.0000000000, -0.3262986782, 2.9709005944,
        -1.1480661321, -0.4550319653, -0.1079883619, -0.0000000000, -0.0000000000, -0.2055677109, -0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.0740427066, -0.0000000000, -0.0313508799, -0.2318741462,
        -0.2383154401, 0.0678167011, -0.0000000000, 0.1190592313, -0.2318741462, -0.2383154401, 0.0678167011,
        -0.0000000000, -0.1190592313, 0.0092527796, -0.1104418179, -0.1079883619, 1.5806435690, 0.0000000000,
        0.0000000000, 0.0646797416, 0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0791656240,
        -0.0000000000, 0.0778220256, -0.0960567105, -0.0779524496, -0.0772999460, -0.0000000000, -0.0184233616,
        -0.0960567105, -0.0779524496, -0.0772999460, 0.0000000000, 0.0184233616, 0.0000000000, -0.0000000000,
        -0.0000000000, 0.0000000000, 1.6267088014, -0.0000000000, -0.0000000000, 0.1055627646, -0.0000000000,
        -0.0000000000, -0.0896027852, -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000,
        0.0000000000, -0.0517814502, 0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, -0.0517814502,
        -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, 1.5508556659,
        -0.0000000000, -0.0000000000, 0.0395846272, -0.1498421206, -0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.1020661159, -0.0410022112, -0.0434941364, 0.0000000000, -0.0974696846, 0.1020661159,
        0.0410022112, 0.0434941364, -0.0000000000, -0.0974696846, 0.0025959735, -0.0964068601, -0.2055677109,
        0.0646797416, -0.0000000000, -0.0000000000, 0.6112673212, -0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, 0.0810880473, -0.0000000000, 0.0616959729, -0.0014857993, -0.0748487187, -0.0306407309,
        -0.0000000000, -0.1777147725, -0.0014857993, -0.0748487187, -0.0306407309, -0.0000000000, 0.1777147725,
        0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, 0.1055627646, -0.0000000000, -0.0000000000,
        0.7378415471, -0.0000000000, -0.0000000000, -0.0772374676, -0.0000000000, -0.0000000000, 0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.1366201109, 0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, 0.1366201109, -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000,
        -0.0000000000, 0.0395846272, -0.0000000000, -0.0000000000, 0.5313335235, -0.1561778621, -0.0000000000,
        0.0000000000, 0.0000000000, 0.0000000000, 0.0379921761, 0.0549326887, -0.2218647710, -0.0000000000,
        -0.1218623854, -0.0379921761, -0.0549326887, 0.2218647710, -0.0000000000, -0.1218623854, -0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, -0.1498421206, -0.0000000000, -0.0000000000,
        -0.1561778621, 4.1659808864, 0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0860056431,
        -0.0159266741, -0.3497616793, -0.0000000000, -0.5642032428, -0.0860056431, 0.0159266741, 0.3497616793,
        0.0000000000, -0.5642032428, -0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, -0.0896027852,
        -0.0000000000, -0.0000000000, -0.0772374676, -0.0000000000, 0.0000000000, 4.2809425857, 0.0000000000,
        -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, 0.1727382544, 0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.1727382544, -0.0000000000, -0.0012368604, 0.0610080248,
        0.0740427066, 0.0791656240, -0.0000000000, 0.0000000000, 0.0810880473, -0.0000000000, 0.0000000000,
        0.0000000000, 0.0000000000, 4.2680864631, 0.0000000000, 0.0215901638, -0.0438114710, 0.0397593177, 0.2450792234,
        -0.0000000000, 0.2984169416, -0.0438114710, 0.0397593177, 0.2450792234, -0.0000000000, -0.2984169416,
        0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000,
        -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, 4.2565121101, 0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.2327237066, -0.0000000000, 0.0000000000, 0.0000000000,
        0.0000000000, -0.2327237066, -0.0000000000, 0.0005480903, -0.0261147588, -0.0313508799, 0.0778220256,
        0.0000000000, 0.0000000000, 0.0616959729, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0215901638,
        0.0000000000, 4.2136446041, 0.0353340513, -0.0040568806, -0.3320121852, 0.0000000000, 0.0226578159,
        0.0353340513, -0.0040568806, -0.3320121852, 0.0000000000, -0.0226578159, 0.5885029073, -0.3928260456,
        -0.2318741462, -0.0960567105, -0.0000000000, -0.1020661159, -0.0014857993, -0.0000000000, 0.0379921761,
        0.0860056431, -0.0000000000, -0.0438114710, -0.0000000000, 0.0353340513, 0.1184982923, -0.1684864958,
        -0.0286350609, -0.0000000000, 0.0122180838, -0.0931020093, -0.1330801015, 0.0323957227, -0.0000000000,
        -0.1029490459, 1.0503876896, -0.5326786265, -0.2383154401, -0.0779524496, -0.0000000000, -0.0410022112,
        -0.0748487187, -0.0000000000, 0.0549326887, -0.0159266741, -0.0000000000, 0.0397593177, -0.0000000000,
        -0.0040568806, -0.1684864958, -0.0808953529, 0.0153450160, -0.0000000000, 0.0630444549, -0.1330801015,
        -0.1271609548, 0.0485339843, -0.0000000000, -0.0699782242, -0.5834574699, 0.2433241368, 0.0678167011,
        -0.0772999460, 0.0000000000, -0.0434941364, -0.0306407309, -0.0000000000, -0.2218647710, -0.3497616793,
        0.0000000000, 0.2450792234, -0.0000000000, -0.3320121852, -0.0286350609, 0.0153450160, 1.5616110425,
        0.0000000000, -0.0848349301, 0.0323957227, 0.0485339843, -0.0430390748, 0.0000000000, 0.0444611737,
        0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000, -0.0517814502, 0.0000000000, -0.0000000000,
        0.1366201109, -0.0000000000, -0.0000000000, 0.1727382544, -0.0000000000, 0.2327237066, 0.0000000000,
        -0.0000000000, -0.0000000000, 0.0000000000, 1.6301189978, 0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, -0.0256734349, -0.0000000000, -0.7472930712, 0.3262986782, 0.1190592313, -0.0184233616,
        0.0000000000, -0.0974696846, -0.1777147725, 0.0000000000, -0.1218623854, -0.5642032428, 0.0000000000,
        0.2984169416, -0.0000000000, 0.0226578159, 0.0122180838, 0.0630444549, -0.0848349301, 0.0000000000,
        1.4986955486, 0.1029490459, 0.0699782242, -0.0444611737, 0.0000000000, 0.1507533870, 0.5885029073,
        -0.3928260456, -0.2318741462, -0.0960567105, -0.0000000000, 0.1020661159, -0.0014857993, -0.0000000000,
        -0.0379921761, -0.0860056431, -0.0000000000, -0.0438114710, 0.0000000000, 0.0353340513, -0.0931020093,
        -0.1330801015, 0.0323957227, -0.0000000000, 0.1029490459, 0.1184982923, -0.1684864958, -0.0286350609,
        -0.0000000000, -0.0122180838, 1.0503876896, -0.5326786265, -0.2383154401, -0.0779524496, -0.0000000000,
        0.0410022112, -0.0748487187, -0.0000000000, -0.0549326887, 0.0159266741, -0.0000000000, 0.0397593177,
        0.0000000000, -0.0040568806, -0.1330801015, -0.1271609548, 0.0485339843, -0.0000000000, 0.0699782242,
        -0.1684864958, -0.0808953529, 0.0153450160, -0.0000000000, -0.0630444549, -0.5834574699, 0.2433241368,
        0.0678167011, -0.0772999460, -0.0000000000, 0.0434941364, -0.0306407309, -0.0000000000, 0.2218647710,
        0.3497616793, -0.0000000000, 0.2450792234, 0.0000000000, -0.3320121852, 0.0323957227, 0.0485339843,
        -0.0430390748, -0.0000000000, -0.0444611737, -0.0286350609, 0.0153450160, 1.5616110425, 0.0000000000,
        0.0848349301, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0517814502, -0.0000000000,
        -0.0000000000, 0.1366201109, -0.0000000000, 0.0000000000, 0.1727382544, -0.0000000000, -0.2327237066,
        0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0256734349, 0.0000000000, -0.0000000000,
        -0.0000000000, 0.0000000000, 1.6301189978, -0.0000000000, 0.7472930712, -0.3262986782, -0.1190592313,
        0.0184233616, -0.0000000000, -0.0974696846, 0.1777147725, -0.0000000000, -0.1218623854, -0.5642032428,
        -0.0000000000, -0.2984169416, -0.0000000000, -0.0226578159, -0.1029490459, -0.0699782242, 0.0444611737,
        -0.0000000000, 0.1507533870, -0.0122180838, -0.0630444549, 0.0848349301, -0.0000000000, 1.4986955486;
    D << 2.3219339107, 1.0469700762, -0.2750823310, 0.0218605792, -0.0000000000, -0.0000000000, -0.0242311557,
        0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, -0.0117737940, 0.0000000000, 0.0062638790,
        0.0093096263, 0.0368491131, 0.0135831666, -0.0000000000, 0.0141645346, 0.0093096263, 0.0368491131, 0.0135831666,
        -0.0000000000, -0.0141645346, 1.0469700762, 3.3311248365, -0.8008750816, 0.0799086378, -0.0000000000,
        -0.0000000000, -0.0711049553, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, -0.0380407590,
        0.0000000000, 0.0196779692, 0.0276991492, 0.1052779318, 0.0382180110, -0.0000000000, 0.0399954058, 0.0276991492,
        0.1052779318, 0.0382180110, -0.0000000000, -0.0399954058, -0.2750823310, -0.8008750816, 0.1933241712,
        0.0150372218, -0.0000000000, -0.0000000000, 0.0127821554, 0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, 0.0082176864, 0.0000000000, -0.0051543434, -0.0068877988, -0.0251994585, -0.0081543585,
        -0.0000000000, -0.0085632459, -0.0068877988, -0.0251994585, -0.0081543585, -0.0000000000, 0.0085632459,
        0.0218605792, 0.0799086378, 0.0150372218, 2.3318539553, -0.0000000000, -0.0000000000, -0.2969453252,
        0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, -0.0639783661, 0.0000000000, -0.0282958517,
        -0.0144040256, 0.0131263907, 0.0725954649, -0.0000000000, 0.0739118773, -0.0144040256, 0.0131263907,
        0.0725954649, -0.0000000000, -0.0739118773, -0.0000000000, -0.0000000000, -0.0000000000, -0.0000000000,
        2.2628249505, 0.0000000000, 0.0000000000, -0.3104600804, 0.0000000000, 0.0000000000, 0.0436231577, 0.0000000000,
        0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0177328642, -0.0000000000,
        0.0000000000, 0.0000000000, -0.0000000000, 0.0177328642, 0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, -0.0000000000, 0.0000000000, 2.3925353532, 0.0000000000, -0.0000000000, -0.3260124507,
        0.1298930304, 0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, -0.0275654518, 0.0735758142,
        0.0707056063, 0.0000000000, 0.1087785864, 0.0275654518, -0.0735758142, -0.0707056063, 0.0000000000, 0.1087785864,
        -0.0242311557, -0.0711049553, 0.0127821554, -0.2969453252, 0.0000000000, 0.0000000000, 0.0389319218,
        0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, 0.0088033261, -0.0000000000, 0.0032252609,
        0.0013174869, -0.0035948765, -0.0099005263, -0.0000000000, -0.0100999015, 0.0013174869, -0.0035948765,
        -0.0099005263, -0.0000000000, 0.0100999015, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -0.3104600804, -0.0000000000, 0.0000000000, 0.0425951912, 0.0000000000, -0.0000000000, -0.0059851068,
        -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0024329529,
        0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0024329529, -0.0000000000, 0.0000000000,
        0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.3260124507, -0.0000000000, 0.0000000000,
        0.0444232174, -0.0176995275, -0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, 0.0037561328,
        -0.0100256122, -0.0096345109, -0.0000000000, -0.0148224240, -0.0037561328, 0.0100256122, 0.0096345109,
        -0.0000000000, -0.0148224240, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000,
        0.1298930304, 0.0000000000, -0.0000000000, -0.0176995275, 0.0070520167, 0.0000000000, -0.0000000000,
        -0.0000000000, -0.0000000000, -0.0014965547, 0.0039945013, 0.0038386749, 0.0000000000, 0.0059056934,
        0.0014965547, -0.0039945013, -0.0038386749, 0.0000000000, 0.0059056934, -0.0000000000, -0.0000000000,
        -0.0000000000, -0.0000000000, 0.0436231577, 0.0000000000, -0.0000000000, -0.0059851068, -0.0000000000,
        0.0000000000, 0.0008409753, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000,
        0.0003418574, -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0003418574, 0.0000000000,
        -0.0117737940, -0.0380407590, 0.0082176864, -0.0639783661, 0.0000000000, 0.0000000000, 0.0088033261,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, 0.0021414632, -0.0000000000, 0.0005539617,
        0.0000915769, -0.0014890156, -0.0023765330, 0.0000000000, -0.0024313074, 0.0000915769, -0.0014890156,
        -0.0023765330, 0.0000000000, 0.0024313074, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000,
        0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0000000000, -0.0000000000,
        -0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0062638790, 0.0196779692,
        -0.0051543434, -0.0282958517, -0.0000000000, -0.0000000000, 0.0032252609, 0.0000000000, 0.0000000000,
        -0.0000000000, -0.0000000000, 0.0005539617, -0.0000000000, 0.0004714438, 0.0003496904, 0.0004910921,
        -0.0006592235, -0.0000000000, -0.0006644508, 0.0003496904, 0.0004910921, -0.0006592235, -0.0000000000,
        0.0006644508, 0.0093096263, 0.0276991492, -0.0068877988, -0.0144040256, 0.0000000000, -0.0275654518,
        0.0013174869, -0.0000000000, 0.0037561328, -0.0014965547, 0.0000000000, 0.0000915769, 0.0000000000, 0.0003496904,
        0.0006455425, -0.0000397424, -0.0009599192, 0.0000000000, -0.0013920261, 0.0000103551, 0.0016556562,
        0.0006693415, 0.0000000000, -0.0011145458, 0.0368491131, 0.1052779318, -0.0251994585, 0.0131263907, 0.0000000000,
        0.0735758142, -0.0035948765, -0.0000000000, -0.0100256122, 0.0039945013, 0.0000000000, -0.0014890156,
        -0.0000000000, 0.0004910921, -0.0000397424, 0.0056452425, 0.0037115053, 0.0000000000, 0.0049443499, 0.0016556562,
        0.0011200008, -0.0006372059, 0.0000000000, 0.0017460199, 0.0135831666, 0.0382180110, -0.0081543585, 0.0725954649,
        -0.0000000000, 0.0707056063, -0.0099005263, 0.0000000000, -0.0096345109, 0.0038386749, -0.0000000000,
        -0.0023765330, -0.0000000000, -0.0006592235, -0.0009599192, 0.0037115053, 0.0047345484, -0.0000000000,
        0.0059193028, 0.0006693415, -0.0006372059, 0.0005554814, -0.0000000000, 0.0005100743, -0.0000000000,
        -0.0000000000, -0.0000000000, -0.0000000000, 0.0177328642, 0.0000000000, -0.0000000000, -0.0024329529,
        -0.0000000000, 0.0000000000, 0.0003418574, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000,
        0.0000000000, -0.0000000000, 0.0001389654, -0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000,
        0.0001389654, 0.0000000000, 0.0141645346, 0.0399954058, -0.0085632459, 0.0739118773, -0.0000000000, 0.1087785864,
        -0.0100999015, 0.0000000000, -0.0148224240, 0.0059056934, -0.0000000000, -0.0024313074, -0.0000000000,
        -0.0006644508, -0.0013920261, 0.0049443499, 0.0059193028, -0.0000000000, 0.0077115664, 0.0011145458,
        -0.0017460199, -0.0005100743, -0.0000000000, 0.0021798492, 0.0093096263, 0.0276991492, -0.0068877988,
        -0.0144040256, 0.0000000000, 0.0275654518, 0.0013174869, -0.0000000000, -0.0037561328, 0.0014965547,
        0.0000000000, 0.0000915769, -0.0000000000, 0.0003496904, 0.0000103551, 0.0016556562, 0.0006693415, 0.0000000000,
        0.0011145458, 0.0006455425, -0.0000397424, -0.0009599192, 0.0000000000, 0.0013920261, 0.0368491131, 0.1052779318,
        -0.0251994585, 0.0131263907, 0.0000000000, -0.0735758142, -0.0035948765, -0.0000000000, 0.0100256122,
        -0.0039945013, -0.0000000000, -0.0014890156, 0.0000000000, 0.0004910921, 0.0016556562, 0.0011200008,
        -0.0006372059, 0.0000000000, -0.0017460199, -0.0000397424, 0.0056452425, 0.0037115053, -0.0000000000,
        -0.0049443499, 0.0135831666, 0.0382180110, -0.0081543585, 0.0725954649, -0.0000000000, -0.0707056063,
        -0.0099005263, 0.0000000000, 0.0096345109, -0.0038386749, -0.0000000000, -0.0023765330, 0.0000000000,
        -0.0006592235, 0.0006693415, -0.0006372059, 0.0005554814, -0.0000000000, -0.0005100743, -0.0009599192,
        0.0037115053, 0.0047345484, -0.0000000000, -0.0059193028, -0.0000000000, -0.0000000000, -0.0000000000,
        -0.0000000000, 0.0177328642, 0.0000000000, -0.0000000000, -0.0024329529, -0.0000000000, 0.0000000000,
        0.0003418574, 0.0000000000, 0.0000000000, -0.0000000000, 0.0000000000, 0.0000000000, -0.0000000000, 0.0001389654,
        -0.0000000000, 0.0000000000, -0.0000000000, -0.0000000000, 0.0001389654, 0.0000000000, -0.0141645346,
        -0.0399954058, 0.0085632459, -0.0739118773, 0.0000000000, 0.1087785864, 0.0100999015, -0.0000000000,
        -0.0148224240, 0.0059056934, 0.0000000000, 0.0024313074, -0.0000000000, 0.0006644508, -0.0011145458, 0.0017460199,
        0.0005100743, 0.0000000000, 0.0021798492, 0.0013920261, -0.0049443499, -0.0059193028, 0.0000000000, 0.0077115664;
  }
};

void LibintTest::testS() {
  std::cout << "Overlap Test\n";

  S_test = compute1e(libint2::Operator::overlap);

  for (auto i = 0L; i < dim; ++i) {
    for (auto j = 0L; j < dim; ++j) {
      EXPECT_THAT(S_test(i, j), DoubleNear(S(i, j), 1e-9));
    }
  }
}

void LibintTest::testT() {
  std::cout << "Kinetic Test\n";

  T_test = compute1e(libint2::Operator::kinetic);

  for (auto i = 0L; i < dim; ++i) {
    for (auto j = 0L; j < dim; ++j) {
      EXPECT_THAT(T_test(i, j), DoubleNear(T(i, j), 1e-9));
    }
  }
}

void LibintTest::testV() {
  std::cout << "Nuclear Test\n";

  V_test = compute1e(libint2::Operator::nuclear);

  for (auto i = 0L; i < dim; ++i) {
    for (auto j = 0L; j < dim; ++j) {
      EXPECT_THAT(V_test(i, j), DoubleNear(V(i, j), 1e-9));
    }
  }
}

void LibintTest::testF() {
  std::cout << "Fock matrix Test\n";

  auto G = compute_2body_fock();

  F_test.resizeLike(G);

  F_test = T_test + V_test + G;

  for (auto i = 0L; i < dim; ++i) {
    for (auto j = 0L; j < dim; ++j) {
      EXPECT_THAT(F_test(i, j), DoubleNear(F(i, j), 1e-9));
    }
  }
}

TEST_F(LibintTest, RunAllTest) {
  testS();
  testT();
  testV();
  testF();
}
